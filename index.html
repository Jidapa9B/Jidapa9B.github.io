<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>บ้านในฝันของคุณ — ตัวอย่าง</title>
  <style>
    :root{--green:#2E8B57; --green-dark:#218a55; --maxw:1100px; --radius:12px}
    *{box-sizing:border-box}
    body{font-family: "Noto Sans", sans-serif; margin:0; color:#123; background:#fafafa}
    .container{max-width:var(--maxw); margin:0 auto; padding:0 18px}
    /* ... [โค้ด CSS เดิมทั้งหมด] ... */

    /* ===== Lightbox (ใหม่) ===== */
    #lightbox{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.85);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    #lightbox img{
      max-width:90%;
      max-height:80%;
      border-radius:12px;
      box-shadow:0 8px 20px rgba(0,0,0,.5);
    }
    .lightbox-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      font-size:40px;
      color:#fff;
      cursor:pointer;
      user-select:none;
      padding:12px;
      background:rgba(0,0,0,0.4);
      border-radius:50%;
    }
    .lightbox-btn:hover{background:rgba(0,0,0,0.6);}
    #lightbox-prev{left:30px;}
    #lightbox-next{right:30px;}
    #lightbox-close{
      position:absolute;
      top:20px; right:30px;
      font-size:34px;
      cursor:pointer;
      color:#fff;
      background:rgba(0,0,0,0.5);
      border-radius:50%;
      padding:6px 12px;
    }
    #lightbox-caption{
      position:absolute;
      bottom:30px;
      left:50%;
      transform:translateX(-50%);
      color:#fff;
      background:rgba(0,0,0,0.5);
      padding:8px 14px;
      border-radius:8px;
      font-size:16px;
      max-width:80%;
      text-align:center;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="hero" style="background-image:url('https://picsum.photos/seed/hero/1600/900')">
    <div class="hero-inner container">
      <h1 class="hero-title">บ้านในฝันของคุณ</h1>
    </div>
  </header>

  <!-- ... [HTML เดิมทั้งหมด] ... -->

  <!-- ===== Lightbox Markup (ใหม่) ===== -->
  <div id="lightbox">
    <span id="lightbox-close">✖</span>
    <span id="lightbox-prev" class="lightbox-btn">❮</span>
    <img id="lightbox-img" src="" alt="">
    <span id="lightbox-next" class="lightbox-btn">❯</span>
    <div id="lightbox-caption"></div>
  </div>

  <script>
    // ... [JS เดิมทั้งหมด] ...

    // (ใหม่) Lightbox logic
    let currentGallery = [];
    let currentIndex = 0;

    function openLightbox(gallery, index){
      currentGallery = gallery;
      currentIndex = index;
      updateLightbox();
      document.getElementById('lightbox').style.display = 'flex';
    }

    function updateLightbox(){
      if(!currentGallery.length) return;
      const item = currentGallery[currentIndex];
      $('#lightbox-img').src = item.img;
      $('#lightbox-caption').textContent = item.title || '';
    }

    function closeLightbox(){
      document.getElementById('lightbox').style.display = 'none';
    }

    function nextLightbox(){
      if(!currentGallery.length) return;
      currentIndex = (currentIndex + 1) % currentGallery.length;
      updateLightbox();
    }

    function prevLightbox(){
      if(!currentGallery.length) return;
      currentIndex = (currentIndex - 1 + currentGallery.length) % currentGallery.length;
      updateLightbox();
    }

    // attach events
    document.getElementById('lightbox-close').addEventListener('click', closeLightbox);
    document.getElementById('lightbox-next').addEventListener('click', nextLightbox);
    document.getElementById('lightbox-prev').addEventListener('click', prevLightbox);
    document.getElementById('lightbox').addEventListener('click', (e)=>{
      if(e.target.id==='lightbox'){ closeLightbox(); }
    });
    document.addEventListener('keydown', (e)=>{
      if($('#lightbox').style.display==='flex'){
        if(e.key==='Escape') closeLightbox();
        if(e.key==='ArrowRight') nextLightbox();
        if(e.key==='ArrowLeft') prevLightbox();
      }
    });

    // ปรับการ render gallery ให้เรียก lightbox แทน window.open
    function openProject(id){
      const p = projects.find(x=>x.id===id); if(!p) return;
      lastViewedId = p.id;
      // ... [โค้ดเดิมใน openProject] ...

      // render แกลเลอรี่
      const gwrap = $('#detail-gallery');
      if(gwrap){
        gwrap.innerHTML = '';
        if(Array.isArray(p.gallery) && p.gallery.length){
          p.gallery.forEach((g,i)=>{
            const card = document.createElement('div');
            card.className = 'gallery-item';
            if(g.bg) card.style.setProperty('--bg', g.bg);
            card.innerHTML = `
              <img src="${g.img}" alt="${g.title}">
              <div class="title">${g.title}</div>`;
            // แก้ตรงนี้: ใช้ lightbox
            card.addEventListener('click', ()=> openLightbox(p.gallery,i));
            gwrap.appendChild(card);
          });
        }else{
          gwrap.innerHTML = '<div style="color:#567">ไม่มีภาพแกลเลอรี่สำหรับโครงการนี้</div>';
        }
      }

      document.getElementById('project-detail').style.display = 'block';
      // ... [ส่วนเดิมของ openProject ต่อ] ...
    }
  </script>
</body>
</html>
